tinymce.PluginManager.add('paste_upload_doc', function(editor, url) {

   id = $(editor.getElement()).attr('id');    
   form = $('#'+id).closest('form');
   action = form.attr('action');

   editorForTicket = false;
   editorForOther = false;
   if(action.indexOf('ticket.form.php') >= 0 || action.indexOf('tracking.injector.php') >= 0){
        editorForTicket = true;
   }else{
        editorForOther = true;
   }

   $input = form.find("input[name='add']");
   fileindex = 0;


   editor.on('drop', function(e) {

      id = $(editor.getElement()).attr('id');    
      form = $('#'+id).closest('form');

      var $myDiv = form.find("div[id='fileupload_info']");
      var $myDivTicket = form.find("div[id='fileupload_info_ticket']");

      if ( ( $myDivTicket.length &&   editorForTicket )  ||   ( $myDiv.length &&  editorForOther && $input.length)){

         processFileDrop(e,editor);

      }else{

         e.preventDefault();
         e.stopPropagation();

      }




    });

    editor.on('PastePreProcess', function(e) {

      id = $(editor.getElement()).attr('id');    
      form = $('#'+id).closest('form');

      //First we check if 'fileupload_info' div use for upload doc exist
      //If exist -> user have right to drop doc 
      var $myDiv = form.find("div[id='fileupload_info']");
      var $myDivTicket = form.find("div[id='fileupload_info_ticket']");

     if ( ( $myDivTicket.length &&   editorForTicket )  ||   ( $myDiv.length &&  editorForOther && $input.length)){

            //Check if data is an image
            if(isImageFromPaste(e.content)){

                processImageFromPaste(e,editor);

            }else if(isImageBlobFromPaste(e.content)){

                processImageBlobFromPaste(e,editor);

            }
            
        }else{

            if(isImageFromPaste(e.content) || isImageBlobFromPaste(e.content)){
               
               e.preventDefault();
               e.stopPropagation();

            }

        }

    });

});

