tinymce.PluginManager.add('paste_upload_doc', function(editor, url) {


    orig_element = $(editor.getElement());
    var name = orig_element.attr('id');
    
    form = $('#'+name).closest('form');

   action = form.attr('action');

   console.log(action);
   editorForTicket = false;
   editorForOther = false;

   if(action.indexOf('ticket.form.php') >= 0){
        editorForTicket = true;
        console.log("ticket");
   }else{
        editorForOther = true;
        console.log("follo");
   }



    fileindex = 0;

    editor.on('drop', function(e) {

    //First we check if 'fileupload_info' div use for upload doc exist
    //If exist -> use have right to drop doc 
    var $myDiv = $('#fileupload_info');
    var $myDivTicket = $('#fileupload_info_ticket');


    
    //if div exist allow to paste
        if ( ( $myDivTicket &&  (editor.getContent() == '' || editorForTicket ))  ||   ( $myDiv &&  (editor.getContent() == ''  ))){

            processFileDrop(e,editor);

        }else{

            e.preventDefault();
            e.stopPropagation();

        }




    });

    editor.on('PastePreProcess', function(e) {

        var $myDiv = $('#fileupload_info');
        var $myDivTicket = $('#fileupload_info_ticket');

        //First we check if 'fileupload_info' div use for upload doc exist
        //If exist -> user have right to drop doc 
        if ( ( $myDivTicket &&   editorForTicket )  ||   ( $myDiv &&  (editor.getContent() == ''  ))){

            console.log('exist');

            //Check if data is an image
            if(isImageFromPaste(e.content)){

                processImageFromPaste(e,editor);

            }else if(isImageBlobFromPaste(e.content)){

                processImageBlobFromPaste(e,editor);

            }
        }else{

             if(isImageFromPaste(e.content) || isImageBlobFromPaste(e.content)){

               
            e.preventDefault();
            e.stopPropagation();

            }



        }

    });

});

